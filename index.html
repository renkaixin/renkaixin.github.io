<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Easy &amp; Breezy</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="Easy & Breezy">
<meta property="og:url" content="http://renhao.me/index.html">
<meta property="og:site_name" content="Easy & Breezy">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Easy & Breezy">
<meta name="twitter:description">
  
    <link rel="alternative" href="/atom.xml" title="Easy &amp; Breezy" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

  <link href="/prettify/prettify.css" rel="stylesheet" type="text/css">

  <script type="text/javascript" src="/prettify/prettify.js"></script>


</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Easy &amp; Breezy</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://renhao.me"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Git提交自动部署" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/09/03/Git提交自动部署/" class="article-date">
  <time datetime="2016-09-03T09:59:24.000Z" itemprop="datePublished">2016-09-03</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/09/03/Git提交自动部署/">Git提交自动部署</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="问题：">问题：</h3><p>通常情况Git都被用作版本控制, 但何不考虑当Git Push到远端Repo后自动发布到线上环境?</p>
<h3 id="方案:">方案:</h3><p>Git hooks是一种简单的解决方案, 配置相应的命令到对应的钩子上,可以实现自动发布。<br>当远端Repo完整接收到Push后,会触发post-receive事件,调用对应的钩子文件,那我们接下来创建这个钩子。</p>
<pre><code class="bash">cd repo/foo.git
cd hooks/
touch post-receive
</code></pre>
<p>当在某一Git目录下执行命令时候, Git默认work-tree和git-dir都是当前目录。<br>此时我们需要在钩子命令中显示定义线上服务的根目录和Git仓库的目录</p>
<pre><code class="bash">git --work-tree=/var/www/site --git-dir=/repo/foo.git checkout -f
</code></pre>
<p>此处执行<code>checkout</code>命令, 强制用<code>git-dir</code>的文件覆盖<code>work-tree</code>的文件</p>
<p>客户端执行:</p>
<pre><code class="bash">git push origin
</code></pre>
<p>文件会自动发布到<code>/var/www/site</code>目录</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://renhao.me/2016/09/03/Git提交自动部署/" data-id="cisn0qgkx00063lcrzd58783i" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-SoftDelete与UniqueIndex的冲突" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/10/SoftDelete与UniqueIndex的冲突/" class="article-date">
  <time datetime="2016-08-10T09:43:31.000Z" itemprop="datePublished">2016-08-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/10/SoftDelete与UniqueIndex的冲突/">SoftDelete与UniqueIndex的冲突</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="问题：">问题：</h2><p>用数据表A的列del标记单条记录是否删除(通常1是删除)，是业务处理中的常用手段，简称Soft Delete。<br>但如果数据表中对某些字段有唯一键约束，就会产生头疼的问题。</p>
<h4 id="考虑如下的表">考虑如下的表</h4><table>
<thead>
<tr>
<th style="text-align:center">phone</th>
<th style="text-align:center">version</th>
<th style="text-align:center">price</th>
<th style="text-align:center">del</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">iPhone</td>
<td style="text-align:center">4S</td>
<td style="text-align:center">2000</td>
<td style="text-align:center">0</td>
</tr>
<tr>
<td style="text-align:center">iPhone</td>
<td style="text-align:center">4S</td>
<td style="text-align:center">3000</td>
<td style="text-align:center">1</td>
</tr>
<tr>
<td style="text-align:center">Galaxy</td>
<td style="text-align:center">S4</td>
<td style="text-align:center">4000</td>
<td style="text-align:center">0</td>
</tr>
</tbody>
</table>
<p>这张表如果建立了phone version的唯一键，就代表了iPhone 4S仅能拥有一种价格。<br>如果希望运用SoftDelete将被删除的数据保存下来，将会被唯一约束从而无法保存。<br>如果同时建立了phone version del的唯一键，将不能同时有2条删除的记录。</p>
<h2 id="解决方案">解决方案</h2><h4 id="1-_(在Mysql环境中)_不设置del而是设置activate">1. (在Mysql环境中) 不设置del而是设置activate</h4><p>mysql对待null值用比较奇怪的模式，认为每个null是唯一的，查询子句中如果出现<code>where a = null</code>是无法查询预期结果的(必须使用<code>a IS NULL</code>)<br>活跃记录的activate设为1，删除记录activate设为null。</p>
<h4 id="2-_(非Mysql环境)_建立有条件的唯一约束">2. (非Mysql环境) 建立有条件的唯一约束</h4><p><code>ADD CONSTRAINT .... WHERE deleted != 1</code> 仅将唯一键约束建立在活跃的记录上</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://renhao.me/2016/08/10/SoftDelete与UniqueIndex的冲突/" data-id="cisn0qgl5000b3lcroljhndaf" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Database/">Database</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-回滚git的提交和push" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/10/回滚git的提交和push/" class="article-date">
  <time datetime="2016-08-10T02:43:00.000Z" itemprop="datePublished">2016-08-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/10/回滚git的提交和push/">回滚git的提交和push</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="问题：">问题：</h3><p>开发中提交了错误的代码，并且将这个commit push到远端Git Repo中。</p>
<h3 id="解决方案">解决方案</h3><p>假设错误的提交版本号是ba65c34, 其parent是c4375469</p>
<p>方案1：</p>
<pre><code class="bash">git revert ba65c34
git push origin
</code></pre>
<p>方案2</p>
<pre><code class="bash">git reset c4375469
git push origin -f
</code></pre>
<p>方案2优点：分支上有更干净的历史（不会呈现错误的commit和revert commit）<br>方案2缺点：<br>1.强制push的瞬间如果有组员提交了代码到同一分支，会被冲掉<br>2.如果组员pull了错误的代码，他将不知道里面有问题且已经修复，如果用方案1他可以在remote的分支历史上看到</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://renhao.me/2016/08/10/回滚git的提交和push/" data-id="cisn0qgl300093lcr3ovbcbnn" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-用Git迁移不同分支的Commit" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/08/02/用Git迁移不同分支的Commit/" class="article-date">
  <time datetime="2016-08-02T10:46:06.000Z" itemprop="datePublished">2016-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/08/02/用Git迁移不同分支的Commit/">用Git迁移不同分支的Commit</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="问题：">问题：</h3><p>在某一新特性feature/A中开发，此时线上有bug需要紧急修复，慌忙中未切换到master分支，而是修改后提交到了feature/A，此时需要将这个commit挪到master中然后提交并push</p>
<h3 id="解决方案">解决方案</h3><ol>
<li>git-log 查找需要迁移的commit<pre><code class="bash">git checkout feature/A
git log --graph --decorate --pretty=oneline --abbrev-commit
</code></pre>
</li>
<li>git cherry-pick 应用迁移出的commit<pre><code class="bash">// 选中需要迁移的commit号 3f90fe7
git checkout master
git cherry-pick 3f90fe7
git push origin
// 修复完毕
</code></pre>
</li>
<li>(可选) reset误提交的commit<pre><code class="bash">//如果需要去 feature/A中撤销这次提交
git checkout feature/A
// 4da72e5 是被cherry-pick走的上一个版本号
git reset --hard 4da72e5
</code></pre>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://renhao.me/2016/08/02/用Git迁移不同分支的Commit/" data-id="cisn0qglb000e3lcrq4v77qt0" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-用Git-Stash-临时储藏手头的变更" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/24/用Git-Stash-临时储藏手头的变更/" class="article-date">
  <time datetime="2016-07-24T09:26:29.000Z" itemprop="datePublished">2016-07-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/24/用Git-Stash-临时储藏手头的变更/">用Git Stash 临时储藏手头的变更</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>当修改当前分支时候，需要切换到其他分支的时候。可以使用 git stash 命令储藏当前分支的变更。</p>
<h3 id="使用情景：">使用情景：</h3><p>正处于一个分支的开发中，得知此分支有最近提交，用git pull获取最新提交的时候可能有冲突，此时可以用</p>
<pre><code class="git">git stash
git pull
git stash pop 获取
</code></pre>
<p>正处于一个分支的开发中，需要紧急修复当前分支上的bug，可以</p>
<pre><code class="git">git stash
fix some bugs…
git commit -m fix bug
git stash pop
</code></pre>
<h3 id="命令：">命令：</h3><pre><code class="git">git stash 储藏当前分支
git stash save -m messages… 附带message信息标记当前的储藏
git stash list 查看储藏列表
git stash pop 应用最近的储藏，并在储藏队列中删除他
git stash apply [&lt;stash&gt;] 应用某一个储藏，并不删除他
git stash show [&lt;stash&gt;] 查看stash的详情，其中变更的文件详情
git stash clear 清除stash堆栈，不可逆操作
git stash drop [&lt;stash&gt;] 删除某一stash
(不解) git branch &lt;branch_name&gt; [&lt;stash&gt;] 用当前的stash创建一个新分支并切换到这个分支上面
</code></pre>
<h4 id="git_branch_还不知道如何使用,_文档原文如下:">git branch 还不知道如何使用, 文档原文如下:</h4><p>Creates and checks out a new branch named <branchname> starting from the commit at which the <stash> was originally created, applies the changes recorded in <stash> to the new working tree and index. If that succeeds, and <stash> is a reference of the form stash@{<revision>}, it then drops the <stash>. When no <stash> is given, applies the latest one.<br>This is useful if the branch on which you ran git stash save has changed enough that git stash apply fails due to conflicts. Since the stash is applied on top of the commit that was HEAD at the time git stash was run, it restores the originally stashed state with no conflicts.</stash></stash></revision></stash></stash></stash></branchname></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://renhao.me/2016/07/24/用Git-Stash-临时储藏手头的变更/" data-id="cisn0qgli000g3lcrkpnqqpm9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-ngChecked-Directive" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/07/19/ngChecked-Directive/" class="article-date">
  <time datetime="2016-07-18T16:44:05.000Z" itemprop="datePublished">2016-07-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/07/19/ngChecked-Directive/">ngChecked Directive</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="问题">问题</h3><pre><code class="html">&lt;input type=“checkbox” ng-model=“one.is_checked” ng-checked=“one.is_checked&quot;&gt;
</code></pre>
<pre><code class="Javascript">one.is_checked = 1;
</code></pre>
<p>期望checkbox选中，但结果是checkbox没有选中。</p>
<h3 id="解决方案">解决方案</h3><pre><code class="html">&lt;input type=“checkbox” ng-model=“one.is_checked” ng-checked=“one.is_checked&quot;&gt;
</code></pre>
<pre><code class="Javascript">one.is_checked = true;
</code></pre>
<p>或</p>
<pre><code class="html">&lt;input type=“checkbox” ng-model=“one.is_checked” ng-true-value=“1&quot;&gt;
</code></pre>
<pre><code class="Javascript">one.is_checked = 1;
</code></pre>
<p>或</p>
<pre><code class="html">&lt;input type=“checkbox” ng-checked=“one.is_checked”&gt;
</code></pre>
<pre><code class="Javascript">one.is_checked = 1;
</code></pre>
<h3 id="原理">原理</h3><p>Angular官方建议ng-model与ng-checked不可同时使用，否则会出现不可预估的结果。<br>ngChecked是为解决记录checkbox的checked属性而设计，表达式求值可以决定当前状态是否选中。而ngModel仅在接到布尔值时候才控制checkbox的选中状态，否则需要指定真假值的具体形式</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://renhao.me/2016/07/19/ngChecked-Directive/" data-id="cisn0qglo000i3lcrwp2qghfi" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular/">Angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-talk-about-life" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/11/talk-about-life/" class="article-date">
  <time datetime="2016-01-11T05:21:17.000Z" itemprop="datePublished">2016-01-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/11/talk-about-life/">小谈生活</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>午休时候陷入了冥想，不知是不是冥想，还是仅仅想了很多。<br>很忙，忙于应付很多突来的事情，待办清单里面的事，来了去，去了来，像极了茶馆小二的迎来送往。<br>可是生命不可重复，时间一直流逝，忙是什么？忙的是什么？为什么要忙？要忙什么？</p>
<p>生命的终点没有奖杯，没有盛大的颁奖仪式，即便有，奖品也不是寿命的延长。</p>
<p>或许一直想得到的，应该是一种确定的感觉，是一种自己明白自己在做什么的安心，是每一次对困惑解开后的恍然大悟，是每一次性能提升后的心满意足，是每一次交付后看到别人很开心后的自己的开心。</p>
<p>去掉那些不安，去掉那些困惑，去掉那些不满，去掉那些不开心，这，就是每天的奖杯吧。</p>
<p>也是生命的意义？</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://renhao.me/2016/01/11/talk-about-life/" data-id="cisn0qglw000m3lcrzvu445d5" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Life/">Life</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-bootstrap-modal-angular-directeves" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/01/01/bootstrap-modal-angular-directeves/" class="article-date">
  <time datetime="2016-01-01T13:36:25.000Z" itemprop="datePublished">2016-01-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2016/01/01/bootstrap-modal-angular-directeves/">把Bootstrap的Modal组件封装成Angular的Directive</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>我在目前的angular项目中使用bootstrap组件情况比较多，尤其喜欢的情景是：Panel负责列表展示，Modal负责详细数据修改。<br>但目前的痛苦之处是：在HTML结构上，凡是用到了Modal的地方，都要完整写一遍Modal的HTML，并且要定义Modal的ID，业务中如果需要展示隐藏这个Modal,还需要在Controller中调用Bootstrap/Modal的API完成。重复代码很多，而且容易出错。<br>这次优化，我将Modal组件封装成了一个指令，它的头/身/尾分别对应3个简单的子指令，又封装了两个元素指令，用来控制Modal的显示和隐藏(任何具有这些元素的DOM，都具备显示或隐藏某一modal的功能)</p>
<h4 id="directives-js">directives.js</h4><pre><code class="Javascript">angular.module(&#39;app&#39;, []).directive(
  &#39;momentModal&#39;, function() {
    return {
        restrict: &#39;E&#39;,
        transclude: true,
        replace: true,
        scope: {
            show : &#39;=&#39;,
            close : &#39;=&#39;
        },
        template:
            &#39;&lt;div class=&quot;modal&quot; style=&quot;display: none;&quot;&gt;\
                &lt;div class=&quot;modal-dialog&quot;&gt;\
                    &lt;div class=&quot;modal-content&quot; ng-transclude&gt;\
                    &lt;/div&gt;\
                &lt;/div&gt;\
            &lt;/div&gt;&#39;,
        link: function (scope, ele, attrs) {

            var title = attrs.title || &#39;&#39;, header;

            if(&#39;size&#39; in attrs &amp;&amp; ~[&#39;lg&#39;, &#39;sm&#39;].indexOf(attrs.size)) {
                ele.find(&#39;.modal-dialog&#39;).addClass(&#39;modal-&#39; + attrs.size);
            }
            if(!ele.find(&#39;.modal-header&#39;).length) {
                header = $compile(&#39;&lt;div class=&quot;modal-header&quot;&gt;\
                            &lt;a href=&quot;javascript:void(0);&quot; moment-modal-close class=&quot;pull-right&quot;&gt;&lt;i class=&quot;fa fa-times&quot;&gt;&lt;/i&gt;&lt;/a&gt;\
                            &lt;h4 class=&quot;modal-title&quot;&gt;&#39; + title + &#39;&lt;/h4&gt;\
                    &lt;/div&gt;&#39;)(scope);
                ele.find(&#39;.modal-content&#39;).prepend(header);
            }

            _.isFunction(scope.show) &amp;&amp; ele.on(&#39;show.bs.modal&#39;, function () {
                scope.show();
            });

            _.isFunction(scope.hide) &amp;&amp; ele.on(&#39;hide.bs.modal&#39;, function () {
                scope.hide();
            });
        }
      };
  }).directive(&#39;momentModalHeader&#39;, function() {
      return {
            restrict: &#39;E&#39;,
            transclude: true,
            replace: true,
            template: &#39;&lt;div class=&quot;modal-header&quot; ng-transclude&gt;&lt;/div&gt;&#39;
      }
  })directive(&#39;momentModalBody&#39;, function() {
      return {
            restrict: &#39;E&#39;,
            transclude: true,
            replace: true,
            template: &#39;&lt;div class=&quot;modal-body&quot; ng-transclude&gt;&lt;/div&gt;&#39;
      }
  })directive(&#39;momentModalFooter&#39;, function() {
      return {
            restrict: &#39;E&#39;,
            transclude: true,
            replace: true,
            template: &#39;&lt;div class=&quot;modal-footer&quot; ng-transclude&gt;&lt;/div&gt;&#39;
      }
  })
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://renhao.me/2016/01/01/bootstrap-modal-angular-directeves/" data-id="cisn0qgm2000p3lcraexmzkmj" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Angular/">Angular</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-introduction-to-page-visibility-API" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/12/30/introduction-to-page-visibility-API/" class="article-date">
  <time datetime="2015-12-30T07:31:25.000Z" itemprop="datePublished">2015-12-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/12/30/introduction-to-page-visibility-API/">Javascript判断当前页面/标签是否正在被用户浏览</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p><a href="http://www.w3.org/TR/page-visibility/" target="_blank" rel="external">W3C</a>规范规定了<a href="https://developer.mozilla.org/en-US/docs/Web/API/Page_Visibility_API" target="_blank" rel="external">PageVisibility API</a>用以帮助人们判断当前页面/标签是否正在被用户浏览（即页面是否可见），当页面隐藏和现实间切换时，触发visibilitychange事件，通过监听这一事件，可以决策当前页面的行为。</p>
<pre><code class="Javascript">(function() {
  var hidden = &quot;hidden&quot;;

  // Standards:
  if (hidden in document)
    document.addEventListener(&quot;visibilitychange&quot;, onchange);
  else if ((hidden = &quot;mozHidden&quot;) in document)
    document.addEventListener(&quot;mozvisibilitychange&quot;, onchange);
  else if ((hidden = &quot;webkitHidden&quot;) in document)
    document.addEventListener(&quot;webkitvisibilitychange&quot;, onchange);
  else if ((hidden = &quot;msHidden&quot;) in document)
    document.addEventListener(&quot;msvisibilitychange&quot;, onchange);
  // IE 9 and lower:
  else if (&quot;onfocusin&quot; in document)
    document.onfocusin = document.onfocusout = onchange;
  // All others:
  else
    window.onpageshow = window.onpagehide
    = window.onfocus = window.onblur = onchange;

  function onchange (evt) {
    var v = &quot;visible&quot;, h = &quot;hidden&quot;,
        evtMap = {
          focus:v, focusin:v, pageshow:v, blur:h, focusout:h, pagehide:h
        };

    evt = evt || window.event;
    if (evt.type in evtMap)
      document.body.className = evtMap[evt.type];
    else
      document.body.className = this[hidden] ? &quot;hidden&quot; : &quot;visible&quot;;
  }

  // set the initial state (but only if browser supports the Page Visibility API)
  if( document[hidden] !== undefined )
    onchange({type: document[hidden] ? &quot;blur&quot; : &quot;focus&quot;});
})();
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://renhao.me/2015/12/30/introduction-to-page-visibility-API/" data-id="cisn0qgm6000s3lcrrnz8149u" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/HTML/">HTML</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-mynewpost" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/07/14/mynewpost/" class="article-date">
  <time datetime="2015-07-14T08:05:59.000Z" itemprop="datePublished">2015-07-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2015/07/14/mynewpost/">Git分支规划的最佳实践</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>在使用Git进行版本控制时，伴随开发生命周期，需要维护很多的分支，如何创建这些分支并明确命名，是一个头疼的问题，本文总结了Git最常用分支的名称和使用场景。</p>
<ul>
<li><strong>master</strong> 主要分支 - 主线分支，HEAD指向的代码与稳定的生产环境代码同步</li>
<li><strong>develop</strong> 主要分支 - 开发线分支，HEAD指向的代码是最新的开发进度，代表了面向下一版本release的最新代码更改，当开发线的代码到达稳定状态并可以发布release时，develop线的代码将被合并到master中，并以一个新的release版本号tag</li>
<li><strong>feature</strong> 辅助分支 - 新功能开发分支 伴随一个新功能开发而存在</li>
<li><strong>release</strong> 辅助分支 - 版本发布分支 在版本准备发布和发布成功之间存在的临时分支，代表了即将发布的代码状态。</li>
<li><strong>hotfix</strong> 辅助分支 - 热修补分支 生产环境出现bug需要紧急修复时候创建的</li>
</ul>
<table>
<thead>
<tr>
<th style="text-align:center">分支名称</th>
<th style="text-align:center">分支类型</th>
<th style="text-align:center">从何处检出</th>
<th style="text-align:center">合并到何处</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">master</td>
<td style="text-align:center">主要</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">develop</td>
<td style="text-align:center">主要</td>
<td style="text-align:center">-</td>
<td style="text-align:center">-</td>
</tr>
<tr>
<td style="text-align:center">feature</td>
<td style="text-align:center">辅助</td>
<td style="text-align:center">develop</td>
<td style="text-align:center">develop</td>
</tr>
<tr>
<td style="text-align:center">release</td>
<td style="text-align:center">辅助</td>
<td style="text-align:center">develop</td>
<td style="text-align:center">develop &amp; master</td>
</tr>
<tr>
<td style="text-align:center">hotfix</td>
<td style="text-align:center">辅助</td>
<td style="text-align:center">master</td>
<td style="text-align:center">develop &amp; master</td>
</tr>
</tbody>
</table>
<h3 id="feature_branches_-_新功能分支">feature branches - 新功能分支</h3><p>新功能分支是branch off from develop，它的生命周期伴随着开发某一特定新功能，新功能开发完成后，将feature分支merge到develop中</p>
<h4 id="创建新功能分支">创建新功能分支</h4><pre><code class="bash">git checkout -b newfeature develop
</code></pre>
<h4 id="合并新功能分支">合并新功能分支</h4><pre><code class="bash">git checkout develop
git merge --no-ff newfeature
git branch -d newfeature
git push orign develop
</code></pre>
<h3 id="release_branches_-_新版本分支">release branches - 新版本分支</h3><p>新版本分支创建于生产环境最新release发布前夕，从develop分支中checkout出来，此时允许在release分支上进行小规模的bugfix并准备版本号等信息。而此时develop分支可以继续工作，接收下一个版本的代码改动。</p>
<h4 id="新版本分支创建时机">新版本分支创建时机</h4><p>新版本分支创建于develop分支的状态已经和预期新版本中的状态一致的时刻。在此时，即将到来的新版本才会根据规则，获取到自己的版本号，而在此之前develop分支中的下一版本号都为next。</p>
<h4 id="创建新版本分支">创建新版本分支</h4><pre><code class="bash">git checkout -b release-1.2.0 develop
./some-shell-to-change-file-version-number.sh
git commit -a -m &quot;Bumped version number to 1.2.0&quot;
</code></pre>
<h4 id="合并新版本分支">合并新版本分支</h4><p>当新版本在进行细微调整后成为真正的新版本时，将会通过以下三步完成一个新版本</p>
<ol>
<li>将新版本分支合并到master分支中，并对master分支打上tag方便引用（<strong>master分支原则上只接受新版本的merge</strong>）</li>
<li>将新版本分支合并到develop分支中，将新版本发布期的更改添加到develop代码中</li>
<li>删除develop分支<br>```bash<h1 id="提交新版本到master中，真正的新版本被创建">提交新版本到master中，真正的新版本被创建</h1>git checkout master<br>git merge —no-ff release-1.2.0<br>git tag -a 1.2.0</li>
</ol>
<h1 id="新版本更改同步到develop中">新版本更改同步到develop中</h1><p>git checkout develop<br>git merge —no-ff release-1.2.0</p>
<h1 id="删除新版本分支">删除新版本分支</h1><p>git branch -d release-1.2.0</p>
<pre><code>### hotfix branches - 热修补分支
当生产环境出现重大问题时，从master上直接checkout，此时可以对master的版本增加一个小版本号用以修复这个bug。此时其他开发人员可以继续在develop分支上工作而不必受到影响。问题修改完成后，将会首先合并热修补分支到master分支中修复生产环境问题，进而合并到develop分支中（**如果存在release分支，应先合并到release中，再由release合并到develop中，但如果develop分支等不及这个bug的修复，可以同时合并到develop分支中**）
####创建热修补分支
```bash
#假设出现问题的master版本是1.2.0
git checkout -b hotfix-1.2.1 master
./some-shell-to-change-file-version-number.sh
git commit -a -m &quot;Bumped version number to 1.2.1&quot;

#修复完成后
git commit -m &quot;Fixed severe production problem&quot;
</code></pre><h4 id="合并热修补分支">合并热修补分支</h4><pre><code class="bash">#首先将hotfix合并到master中，解决问题
git checkout master
git merge --no-ff hotfix-1.2.1
git tag -a 1.2.1

#将hotfix合并到develop中
git checkout develop
git merge --no-ff hotfix-1.2.1

#删除hotfix分支
git branch -d hotfix-1.2.1
</code></pre>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://renhao.me/2015/07/14/mynewpost/" data-id="cisn0qgkn00033lcro9wmpjn9" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Git/">Git</a></li></ul>

    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Angular/">Angular</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Database/">Database</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/HTML/">HTML</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Javascript/">Javascript</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Life/">Life</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Angular/" style="font-size: 13.33px;">Angular</a> <a href="/tags/Database/" style="font-size: 10px;">Database</a> <a href="/tags/Git/" style="font-size: 20px;">Git</a> <a href="/tags/HTML/" style="font-size: 10px;">HTML</a> <a href="/tags/Javascript/" style="font-size: 16.67px;">Javascript</a> <a href="/tags/Life/" style="font-size: 10px;">Life</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/09/">September 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/08/">August 2016</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">July 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/01/">January 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">December 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">July 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/09/03/Git提交自动部署/">Git提交自动部署</a>
          </li>
        
          <li>
            <a href="/2016/08/10/SoftDelete与UniqueIndex的冲突/">SoftDelete与UniqueIndex的冲突</a>
          </li>
        
          <li>
            <a href="/2016/08/10/回滚git的提交和push/">回滚git的提交和push</a>
          </li>
        
          <li>
            <a href="/2016/08/02/用Git迁移不同分支的Commit/">用Git迁移不同分支的Commit</a>
          </li>
        
          <li>
            <a href="/2016/07/24/用Git-Stash-临时储藏手头的变更/">用Git Stash 临时储藏手头的变更</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 任浩<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>